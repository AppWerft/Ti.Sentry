/**
 * This file was auto-generated by the Titanium Module SDK helper for Android
 * Appcelerator Titanium Mobile
 * Copyright (c) 2009-2010 by Appcelerator, Inc. All Rights Reserved.
 * Licensed under the terms of the Apache Public License
 * Please see the LICENSE included with this distribution for details.
 *
 */
package ti.sentry;

import org.appcelerator.kroll.KrollDict;
import org.appcelerator.kroll.KrollModule;
import org.appcelerator.kroll.annotations.Kroll;
import org.appcelerator.titanium.TiApplication;
import org.appcelerator.titanium.TiProperties;
import org.appcelerator.kroll.common.Log;
import org.appcelerator.kroll.common.TiConfig;

import com.joshdholtz.sentry.Sentry;

@Kroll.module(name = "Sentry", id = "ti.sentry")
public class SentryModule extends KrollModule {

	// Standard Debugging variables
	private static final String LCAT = "SentryModule";
	private static final boolean DBG = TiConfig.LOGD;

	// You can define constants with @Kroll.constant, for example:
	// @Kroll.constant public static final String EXTERNAL_NAME = value;

	public SentryModule() {
		super();
	}

	@Kroll.onAppCreate
	public static void onAppCreate(TiApplication app) {
		TiProperties appProperties = TiApplication.getInstance()
				.getAppProperties();
		String sentryDSN = appProperties.getString("SENTRY_DSN",
				"YOUR-SENTRY-DSN");
		Sentry.init(TiApplication.getInstance(), sentryDSN);
	}

	@Kroll.method
	public void captureMessage(String msg) {
		Sentry.captureMessage(msg);
	}

	@Kroll.method
	public void addHttpBreadcrumb(String url, String method, int result) {
		Sentry.addHttpBreadcrumb(url, method, result);
	}

	@Kroll.method
	public void addNavigationBreadcrumb(String event, String foo, String bar) {
		Sentry.addNavigationBreadcrumb(event, foo, bar);
	}

	@Kroll.method
	public void addBreadcrumb(String event, String payload) {
		Sentry.addBreadcrumb(event, payload);
	}

	@Kroll.method
	public void captureEvent(KrollDict kd) {
		Sentry.captureEvent(new Sentry.SentryEventBuilder()
				.setMessage(kd.getString("message"))
				.setCulprit(kd.getString("culprit"))
				.setTimestamp(System.currentTimeMillis()));
	}

}
